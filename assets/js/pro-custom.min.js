const AutoTranslator=function(window,$,gTranslateWidget){const locoConf=window.locoConf,configData=window.extradata;let translationPerformed=!1;const{ajax_url:ajaxUrl,nonce:nonce,ATLT_URL:ATLT_URL,extra_class:rtlClass,api_key:apikey,dashboard_url:dashboardurl}=configData,allStrings=locoConf.conf.podata;let pluginOrThemeName="";if(locoConf&&locoConf.conf&&locoConf.conf.project&&locoConf.conf.project.bundle){const isTheme=locoConf.conf.project.bundle.startsWith("theme.");if(isTheme)pluginOrThemeName=locoConf.conf.project.domain||"";else{const match=locoConf.conf.project.bundle.match(/^[^.]+\.(.*?)(?=\/)/);pluginOrThemeName=match?match[1]:""}}function onLoad(){if(locoConf&&locoConf.conf){const{conf:conf}=locoConf;allStrings.shift();const{locale:locale,project:project}=conf,projectId=generateProjectId(project,locale);createStringsModal(projectId,"ChromeAiTranslator"),addStringsInModal(allStrings)}}function initialize(){const{conf:conf}=locoConf,{locale:locale,project:project}=conf,projectId=generateProjectId(project,locale);function openTranslateModel(modelIdPrefix,modelName){const modelContainer=$(`div#${modelIdPrefix}-widget-model.${modelIdPrefix}-widget-container`),defaultLangCode=locoConf.conf.locale.lang||null,deeplLanguages=["ar","bg","cs","da","de","el","en","en-gb","en-us","es","es-419","et","fi","fr","he","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt","pt-br","pt-pt","ro","ru","sk","sl","sv","th","tr","uk","vi","zh","zh-hans","zh-hant"],supportedLanguages="deepl"===modelIdPrefix?deeplLanguages:["af","sq","am","ar","hy","az","eu","bs","bg","ca","ceb","cs","cy","da","nl","et","fi","gl","ka","de","el","gu","he","hi","hu","is","id","it","ja","jv","kn","kk","km","ko","lo","lv","lt","mk","ms","ml","mr","mn","ne","pl","ro","ru","sr","si","sk","sl","sw","sv","ta","te","th","tr","uk","ur","uz","vi","cy","ceb","be","bn","zh","zh-TW","en","tl","fr","fa","pt","pa","sd","es","bn_BD","fa_AF","fr_CA","fr_FR","es_ES","es_CL","es_VE","es_EC","es_DO","es_UY","es_PR","es_MX","es_GT","es_CO","es_CR","es_PE","es_AR","pt_BR","pt_PT","zh_TW","zh_CN","zh_HK","tl","zh","ja"];$("#atlt-dialog").dialog("close"),supportedLanguages.includes(defaultLangCode)?(modelContainer.find(".notice-container").removeClass().empty(),modelContainer.find(".atlt_string_container, .choose-lang, .atlt_save_strings, .translator-widget").show()):(modelContainer.find(".notice-container").addClass("notice inline notice-warning").html(`${modelName} Translator does not support this language.`),modelContainer.find(".atlt_string_container, .choose-lang, .atlt_save_strings, .translator-widget, .notice-info, .is-dismissible").hide()),modelContainer.fadeIn("slow")}0===$("#loco-editor nav").find("#cool-auto-translate-btn").length&&addAutoTranslationBtn(),settingsModel(),$("#cool-auto-translate-btn").on("click",openSettingsModel),$("button.icon-robot[data-loco='auto']").on("click",openTranslationProviderModel),$("#atlt_yandex_translate_btn").on("click",(function(){openYandexTranslateModel(locale)})),$("#atlt_google_translate_btn").on("click",(function(){openGoogleTranslateModel(locale)})),$("#google_translate_element").change((function(){gTranslateWidgetOnChange()})),$("#ChromeAiTranslator_settings_btn").on("click",(function(){openChromeAiTranslatorModel(locale)})),$("#atlt_chatGPT_btn").on("click",(function(){const max_size=70,parts=[];let currentTab=0;const source_String={},translatedObj=[];var plainStrArr=filterRawObject(allStrings,"plain");for(let i=0;i<plainStrArr.length;i++)source_String[i+1]=plainStrArr[i].source;openChatGPTTranslateModel(locale,projectId,70,parts,0,translatedObj,source_String)})),$("#atlt_openai_btn").on("click",(function(){openTranslateModel("openAI","OpenAI")})),$("#atlt_geminiAI_btn").on("click",(function(){openTranslateModel("geminiAI","GeminiAI")})),$("#atlt_deepl_btn").on("click",(function(){openTranslateModel("deepl","DeepL")})),$(".atlt_addApikey_btn").on("click",(function(){window.location.href=dashboardurl+"&tab=settings"}));const filterstring=filterRawObject(allStrings,"plain"),sourceValues=Object.fromEntries(filterstring.map((item,index)=>[index+1,item.source.trim().replace(/\s+/g," ")])),selectedStringsBatches=calculateTokensInBatches(sourceValues);$("#geminiAI_translate_button").on("click",(function(){ajaxCall(selectedStringsBatches,locale,sourceValues,"geminiAI","google")})),$("#openAI_translate_button").on("click",(function(){ajaxCall(selectedStringsBatches,locale,sourceValues,"openAI","openai")})),$("#deepl_translate_button").on("click",(function(){ajaxCall(selectedStringsBatches,locale,sourceValues,"deepl","deepl")})),$(".atlt_save_strings").on("click",onSaveClick)}function destoryGoogleYandexTranslator(){translationPerformed=!1,$('.skiptranslate iframe[id=":1.container"]').contents().find('a[id=":1.close"][title="Close"] img').trigger("click"),$(".yt-button__icon.yt-button__icon_type_right").trigger("click"),$(".atlt_custom_model.google-widget-container,.atlt_custom_model.yandex-widget-container").find(".atlt_string_container").scrollTop(0);const progressContainer=$(".modal-body.google-widget-body,.modal-body.yandex-widget-body").find(".atlt_translate_progress");progressContainer.hide(),progressContainer.find(".atlt_actions > .atlt_save_strings").prop("disabled",!0),progressContainer.find(".atlt_stats").hide(),progressContainer.find(".progress-wrapper").hide(),progressContainer.find("#myProgressBar").css("width","0"),progressContainer.find("#progressText").text("0%")}function addStringsInModal(allStrings){var plainStrArr=filterRawObject(allStrings,"plain");plainStrArr.length>0?(printStringsInPopup(plainStrArr,type="yandex"),printStringsInPopup(plainStrArr,type="google"),printStringsInPopup(plainStrArr,type="geminiAI"),printStringsInPopup(plainStrArr,type="openAI"),printStringsInPopup(plainStrArr,type="deepl"),printStringsInPopup(plainStrArr,type="ChromeAiTranslator")):($("#ytWidget").hide(),$(".notice-container").addClass("notice inline notice-warning").html("There is no plain string available for translations."),$(".atlt_string_container, .choose-lang, .atlt_save_strings, #google_translate_element, .translator-widget,.chatGPT_save_close, .chatGPT_save_cont, .notice-info, .is-dismissible").hide())}function generateProjectId(project,locale){const{domain:domain}=project||{},{lang:lang,region:region}=locale;return project?`${domain}-${lang}-${region}`:`temp-${lang}-${region}`}function calculateTokensInBatches(stringsObj){const maxTokens=500;let selectedStringsBatch={},totalTokensBatch=0,selectedStringsBatches=[];const entries=Object.entries(stringsObj);for(let i=0;i<entries.length;i++){const[key,value]=entries[i],length=value.length,tokens=Math.ceil(length/4);totalTokensBatch+tokens<=500?(selectedStringsBatch[key]=value,totalTokensBatch+=tokens):(selectedStringsBatches.push(selectedStringsBatch),selectedStringsBatch={[key]:value},totalTokensBatch=tokens)}return Object.keys(selectedStringsBatch).length>0&&selectedStringsBatches.push(selectedStringsBatch),selectedStringsBatches}function ajaxCall(sourceValues,locale,allSourceValues,translator,selectedApi){const BATCH_SIZE=15,DELAY=0,state={ajaxStore:[],totalSourceCount:Object.values(allSourceValues).reduce((sum,str)=>sum+str.length,0),isModalAppended:!1,isTbodyEmpty:!1,translatedResponse:[],totalTranslatedCount:0,totalTranslatedWords:0,currentIndex:0,stopProcess:!0,stopResponse:!1,uiUpdated:!1,startTime:new Date},container=$(`#${translator}-widget-model`),elements={progressBar:container.find("#myProgressBar"),progressText:container.find("#progressText"),tbody:container.find(".atlt_strings_table > tbody.atlt_strings_body"),warningWrapper:container.find(".warning-massage-content"),warningMessage:container.find(".atlt_translate_warning-massage"),progressIndicator:container.find(".atlt_translate_progress"),translateButton:container.find(`#${translator}_translate_button`),stats:container.find(".atlt_stats")};function initializeUI(){elements.progressIndicator.fadeIn("slow"),container.find(".progress-wrapper").show(),setupEventListeners()}function setupEventListeners(){container.find(`${translator}-widget-header .close`).on("click",()=>{state.stopProcess=!1}),container.find(".close-button").on("click",()=>{elements.warningMessage.fadeOut("slow")})}function processTranslatedStrings(translatedStrings,metadata,sourceValues,selectedApi){const regex=/(?:\\{1,2}u([0-9a-fA-F]{4})|\\u([0-9a-fA-F]{4}))/g,source=[],target=[],batchIndex=metadata&&metadata.batchIndex?metadata.batchIndex:0,requestIndex=metadata&&metadata.requestIndex?metadata.requestIndex:0,globalIndex=15*batchIndex+requestIndex,originalSource=sourceValues[globalIndex];function decodeUnicode(str){return Array.isArray(str)&&(str=str.join("")),str.replace(regex,(match,p1,p2)=>String.fromCharCode(parseInt(p1||p2,16)))}function processEachString(data){if("object"==typeof data){const key=Object.keys(data)[0],value=data[key];if("string"==typeof value&&value.trim()){const cleanedTarget=decodeUnicode(value).replace(/\\/g,"");originalSource&&originalSource[key]&&(source.push(originalSource[key]),target.push(cleanedTarget))}}}if(Array.isArray(translatedStrings)||"deepl"===selectedApi){if(originalSource&&"object"==typeof originalSource){const orderedKeys=Object.keys(originalSource).map(k=>parseInt(k,10)).sort((a,b)=>a-b).map(n=>String(n));for(let i=0;i<orderedKeys.length&&i<translatedStrings.length;i++){const key=orderedKeys[i],val=translatedStrings[i];if("string"==typeof val&&val.trim()){const cleanedTarget=decodeUnicode(val).replace(/\\/g,"");source.push(originalSource[key]),target.push(cleanedTarget)}}}}else translatedStrings&&"object"==typeof translatedStrings&&Object.keys(translatedStrings).forEach(key=>{Object.prototype.hasOwnProperty.call(translatedStrings,key)&&processEachString({[key]:translatedStrings[key]})});return{source:source,target:target}}function updateProgress(){const progressValue=Math.round(state.totalTranslatedCount/state.totalSourceCount*100);elements.progressBar.css("width",`${progressValue}%`),elements.progressText.text(`${progressValue}%`),elements.progressText.css("color","#f3f3f3")}function handleSuccessfulTranslation(){const message=state.totalTranslatedCount<state.totalSourceCount?`Wahooo! You have saved your valuable time by using auto-translation. You have translated <strong class="totalChars">${state.totalTranslatedCount}</strong> characters Out of <strong class="totalChars">${state.totalSourceCount}</strong> characters using <strong><a href="https://wordpress.org/support/plugin/automatic-translator-addon-for-loco-translate/reviews/#new-post" target="_new">LocoAI – Auto Translate for Loco Translate (Pro)</a></strong>`:`Wahooo! You have saved your valuable time via auto translating <strong class="totalChars">${state.totalTranslatedCount}</strong> characters using <strong><a href="https://wordpress.org/support/plugin/automatic-translator-addon-for-loco-translate/reviews/#new-post" target="_new">LocoAI – Auto Translate for Loco Translate (Pro)</a></strong>`;elements.stats.html(message),elements.translateButton.prop("disabled",!0).css({"background-color":"#cccccc",cursor:"not-allowed",opacity:"1"})}function makeAjaxRequest(chunk,batchIndex,requestIndex){const data={action:"atlt_geminiAI_openAI_ajax_handler",nonce:nonce,source_data:{locale:locale,source:chunk,selectedApi:selectedApi},metadata:{batchIndex:batchIndex,requestIndex:requestIndex}};return new Promise((resolve,reject)=>{state.ajaxStore.push($.ajax({url:ajaxUrl,type:"POST",data:data,success:function(response){if(!state.stopResponse&&!response.success)return state.stopProcess=!1,state.stopResponse=!0,elements.warningWrapper.html(`<h2>${response.data}</h2>`),elements.warningMessage.fadeIn("slow"),elements.progressIndicator.fadeOut("slow"),state.ajaxStore.forEach(item=>item.abort()),void resolve();if(response.success&&response.data&&response.data.data){const result=processTranslatedStrings(response.data.data,response.data.metadata,sourceValues,selectedApi),{source:source,target:target}=result;state.translatedResponse.push(Boolean(response.data.data));let tbody="";for(let j=0;j<source.length;j++)tbody+=`<tr id="${state.currentIndex}"><td>${state.currentIndex+1}</td><td class="notranslate source">${encodeHtmlEntity(source[j])}</td>`,tbody+=`<td class="target translate">${encodeHtmlEntity(target[j])}</td></tr>`,state.currentIndex++;if(state.totalTranslatedCount+=source.reduce((sum,str)=>sum+str.length,0),state.totalTranslatedWords+=source.reduce((sum,str)=>sum+str.trim().split(/\s+/).filter(word=>word.length>0).length,0),updateProgress(),!state.isModalAppended&&tbody&&(elements.tbody.html(""),state.isModalAppended=!0),tbody){elements.tbody.append(tbody);const stringContainer=container.find(".atlt_string_container");stringContainer.off("scroll").stop();const tbodyScrollHeight=stringContainer.find(".atlt_strings_table tbody").prop("scrollHeight"),scrollSpeed=3e3;tbodyScrollHeight>100&&"block"===container.css("display")&&stringContainer.animate({scrollTop:tbodyScrollHeight},scrollSpeed,"linear")}else handleEmptyResponse()}resolve()},error:reject}))})}function handleEmptyResponse(){state.isTbodyEmpty=!0,state.stopProcess=!1,state.stopResponse=!0,elements.warningWrapper.find("h2:contains('Translation Aborted.')").length||elements.warningWrapper.append("<h2>Translation Aborted.</h2>"),elements.warningMessage.fadeIn("slow"),elements.progressIndicator.fadeOut("slow"),state.ajaxStore.forEach(item=>item.abort())}async function processChunksInBatches(){try{for(let i=0;i<sourceValues.length&&("block"!==container.css("display")||state.stopResponse||(state.stopProcess=!0),state.stopProcess);i+=15){const batch=sourceValues.slice(i,i+15),batchIndex=Math.floor(i/15);await Promise.allSettled(batch.map((chunk,requestIndex)=>makeAjaxRequest(chunk,batchIndex,requestIndex))),i+15<sourceValues.length&&await new Promise(resolve=>setTimeout(resolve,0))}function updateTranslationUI(){if(!state.uiUpdated){elements.progressBar.css({"background-image":"none",animation:"none","background-size":"none"}),state.uiUpdated=!0;const endTime=new Date,timeTaken=Math.round((endTime-state.startTime)/1e3);function formatNumberShort(n){return(n=Number(n))>=1e6?(n/1e6).toFixed(1).replace(/\.0$/,"")+"M":n>=1e3?(n/1e3).toFixed(1).replace(/\.0$/,"")+"K":n.toString()}container.data("translation-time",timeTaken),container.data("translation-provider",translator);const formattedCount=formatNumberShort(state.totalTranslatedCount);elements.progressIndicator.append(`Wahooo! You have saved your valuable time via auto translating ${formattedCount} characters using ${"google"===selectedApi?"GeminiAI":"deepl"===selectedApi?"DeepL":"OpenAI"} Translator`),setTimeout(()=>{container.find(".atlt_save_strings").prop("disabled",!1),elements.stats.fadeIn("slow"),elements.progressIndicator.fadeOut("slow"),handleSuccessfulTranslation()},3e3)}}if(state.translatedResponse.some(Boolean)&&!state.isTbodyEmpty){const stringContainer=container.find(".atlt_string_container"),scrollHeight=stringContainer[0].scrollHeight,offsetHeight=stringContainer[0].offsetHeight;stringContainer.on("scroll",(function(){const scrollHeight=stringContainer[0].scrollHeight,scrollTop=stringContainer[0].scrollTop,clientHeight=stringContainer[0].clientHeight,tolerance=5,iscomplete=Math.ceil(scrollTop+clientHeight)>=scrollHeight-5;iscomplete&&updateTranslationUI()})),offsetHeight==scrollHeight&&updateTranslationUI()}else elements.progressIndicator.fadeOut("slow"),handleEmptyResponse()}catch(error){console.error("An error occurred during the AJAX processing:",error),elements.progressIndicator.fadeOut("slow")}}initializeUI(),processChunksInBatches().catch(error=>{console.error("An error occurred during the AJAX processing:",error),elements.progressIndicator.fadeOut("slow")})}function openYandexTranslateModel(locale){const defaultcode=locale.lang||null;let defaultlang="";const langMapping={bel:"be",snd:"sd",jv:"jv",nb:"no",nn:"no"};defaultlang=langMapping[defaultcode]||defaultcode;let modelContainer=$("div#yandex-widget-model.yandex-widget-container");modelContainer.find(".atlt_actions > .atlt_save_strings").prop("disabled",!0),modelContainer.find(".atlt_stats").hide(),localStorage.setItem("lang",defaultlang);const supportedLanguages=["kir","he","af","jv","no","am","ar","az","ba","be","bg","bn","bs","ca","ceb","cs","cy","da","de","el","en","eo","es","et","eu","fa","fi","fr","ga","gd","gl","gu","he","hi","hr","ht","hu","hy","id","is","it","ja","jv","ka","kk","km","kn","ko","ky","la","lb","lo","lt","lv","mg","mhr","mi","mk","ml","mn","mr","mrj","ms","mt","my","ne","nl","no","pa","pap","pl","pt","ro","ru","si","sk","sl","sq","sr","su","sv","sw","ta","te","tg","th","tl","tr","tt","udm","uk","ur","uz","vi","xh","yi","zh"];supportedLanguages.includes(defaultlang)?($("#atlt-dialog").dialog("close"),modelContainer.fadeIn("slow")):($("#atlt-dialog").dialog("close"),modelContainer.find(".notice-container").addClass("notice inline notice-warning").html("Yandex Automatic Translator Does not support this language."),modelContainer.find(".atlt_string_container, .choose-lang, .atlt_save_strings, #ytWidget, .translator-widget, .notice-info, .is-dismissible").hide(),modelContainer.fadeIn("slow"))}function openGoogleTranslateModel(locale){var defaultcode=locale.lang?locale.lang:null;switch(defaultcode){case"bel":defaultlang="be";break;case"he":defaultlang="iw";break;case"snd":defaultlang="sd";break;case"jv":defaultlang="jw";break;case"nb":case"nn":defaultlang="no";break;default:defaultlang=defaultcode}var arr=["ckb","szl","oci","kir","fur","bo","as","af","en","zh","no","sq","am","ar","hy","az","eu","be","bn","bs","bg","ca","ceb","ny","zh-CN","zh-TW","co","hr","cs","da","nl","eo","et","tl","fi","fr","fy","gl","ka","de","el","gu","ht","ha","haw","iw","hi","hmn","hu","is","ig","id","ga","it","ja","jw","kn","kk","km","rw","ko","ku","ky","lo","la","lv","lt","lb","mk","mg","ms","ml","mt","mi","mr","mn","my","ne","no","or","ps","fa","pl","pt","pa","ro","ru","sm","gd","sr","st","sn","sd","si","sk","sl","so","es","su","sw","sv","tg","ta","tt","te","th","tr","tk","uk","ur","ug","uz","vi","cy","xh","yi","yo","zu"];let modelContainer=$("div#google-widget-model.google-widget-container");modelContainer.find(".atlt_actions > .atlt_save_strings").prop("disabled",!0),modelContainer.find(".atlt_stats").hide(),arr.includes(defaultlang)?($("#atlt-dialog").dialog("close"),modelContainer.fadeIn("slow"),gTranslateWidget()):($("#atlt-dialog").dialog("close"),modelContainer.find(".notice-container").addClass("notice inline notice-warning").html("Google Automatic Translator Does not support this language."),modelContainer.find(".atlt_string_container, .choose-lang, .atlt_save_strings, .translator-widget, .notice-info, .is-dismissible").hide(),modelContainer.fadeIn("slow"))}async function openChromeAiTranslatorModel(locale){var defaultcode=locale.lang?locale.lang:null;switch(defaultcode){case"bel":defaultlang="be";break;case"he":defaultlang="iw";break;case"snd":defaultlang="sd";break;case"jv":defaultlang="jw";break;case"nb":case"nn":defaultlang="no";break;default:defaultlang=defaultcode}let modelContainer=$("div#ChromeAiTranslator-widget-model.ChromeAiTranslator-widget-container");modelContainer.find(".atlt_actions > .atlt_save_strings").prop("disabled",!0),modelContainer.find(".atlt_stats").hide(),$("#atlt-dialog").dialog("close"),modelContainer.fadeIn("slow"),gTranslateWidget(),translationPerformed&&$("#ChromeAiTranslator-widget-model").find(".atlt_save_strings").prop("disabled",!1)}function gTranslateWidgetOnChange(){var container=$("#google-widget-model"),stringContainer=container.find(".atlt_string_container");const startTime=new Date;function formatNumberShort(n){return(n=Number(n))>=1e6?(n/1e6).toFixed(1).replace(/\.0$/,"")+"M":n>=1e3?(n/1e3).toFixed(1).replace(/\.0$/,"")+"K":n.toString()}function showGoogleTranslationSuccess(container){var charCount,formattedCharCount,message=`Wahooo! You have saved your valuable time via auto translating ${formatNumberShort($(".atlt_stats .totalChars").first().text().trim())} characters using Google Translator`;container.data("message-added")||(container.data("message-added",!0),container.find(".atlt_translate_progress").append(message))}stringContainer.scrollTop(0);var scrollHeight=stringContainer[0].scrollHeight,scrollSpeed=Math.min(1e4,scrollHeight);if(void 0!==scrollHeight&&scrollHeight>100){container.find(".progress-wrapper").show(),container.find(".atlt_translate_progress").fadeIn("slow");const progressBar=container.find(".progress-wrapper .progress-bar");setTimeout(()=>{"block"===(container=$("#google-widget-model")).css("display")?stringContainer.animate({scrollTop:scrollHeight+2e3},2*scrollSpeed,"linear"):container.find(".atlt_translate_progress").fadeOut()},2e3),stringContainer.on("scroll",(function(e){if("none"===(container=$("#google-widget-model")).css("display"))return container.find(".atlt_translate_progress").fadeOut("slow"),stringContainer.stop(),void stringContainer.scrollTop(0);var scrollTop,scrollHeight,clientHeight,scrollPercentage=e.target.scrollTop/(e.target.scrollHeight-e.target.clientHeight)*100,isScrolledToBottom;progressBar.css("width",scrollPercentage+"%"),progressBar.find("#progressText").text((Math.round(10*scrollPercentage)/10).toFixed(1)+"%"),$(this).scrollTop()+$(this).innerHeight()+50>=$(this)[0].scrollHeight&&(showGoogleTranslationSuccess(container),setTimeout(()=>{onCompleteTranslation(container,startTime)},4e3))})),stringContainer.innerHeight()+10>=scrollHeight&&(showGoogleTranslationSuccess(container),setTimeout(()=>{onCompleteTranslation(container,startTime)},1500))}else showGoogleTranslationSuccess(container),setTimeout(()=>{onCompleteTranslation(container,startTime)},2e3)}function onCompleteTranslation(container,startTime){translationPerformed=!0;const isTranslated=$(".goog-te-combo option:selected").val();if(translationPerformed&&isTranslated){const endTime=new Date,timeTaken=Math.round((endTime-startTime)/1e3);container.find(".atlt_save_strings").prop("disabled",!1),container.find(".atlt_stats").fadeIn("slow"),container.find(".atlt_translate_progress").fadeOut("slow"),container.find(".atlt_string_container").stop(),$("body").css("top","0"),container.data("translation-time",timeTaken),container.data("translation-provider","google")}else $(".atlt_custom_model.google-widget-container").find(".atlt_string_container").scrollTop(0),translationPerformed=!1}function openChatGPTTranslateModel(locale,projectId,max_size,parts,currentTab,translatedObj,source_String){modelContainer=$("div#chatGPT-widget-model.chatGPT-widget-container"),$("#atlt-dialog").dialog("close"),$(".modal-footer.chatGPT-widget-footer .atlt_actions").addClass("chatGPT_disable"),$(".chatGPT_save_cont").addClass("btn-disabled"),$(".chatGPT_save_close").addClass("btn-disabled"),modelContainer.fadeIn("slow"),modelContainer.find(".atlt_string_container, .atlt_save_strings").hide(),createParts(parts,source_String,max_size,modelContainer),modelContainer.find(".chatGptError, .chatGPT_table, .chatGPT_table_close, .clear-button, .preview-button").hide(),showTab(currentTab),$(".chatGPT_step-1").addClass("chatGPT_steps-border"),$(".chatGPT_step-2, .chatGPT_step-3").removeClass("chatGPT_steps-border"),updateChatGptButtons(parts,currentTab,modelContainer,projectId);var totalParts=parts.length,currentPart=0,progressbar=$("#chatGPT_progressbar");1==totalParts&&($(".chatGPT_progress").hide(),$(`#chatGPT_progress-label${currentTab}`).hide(),$(".preview-button").css({top:"231px"})),progressbar.css("width",0);var ratioText=`(${currentPart+1} / ${totalParts} Parts)`;$(`#chatGPT_progress-label${currentTab}`).text(ratioText),$("#prevButton").on("click",(function(){if(currentTab>0){var errorContainer=$(`#chatGptError${currentTab}`);if(currentTab--,updateChatGptButtons(parts,currentTab,modelContainer,projectId),showTab(currentTab),$(`#chatGPT_table_close${currentTab}`).hide(),$(`#table${currentTab}`).hide(),$(`#Part${currentTab}`).show(),$(`#chatGPT_steps${currentTab}`).show(),errorContainer&&($(".chatGptError, .clear-button, .preview-button").hide(),$("textarea").val("")),0==currentPart)return;currentPart--,progressbar.css("width",Math.round(100*currentPart/totalParts)+"%");var ratioText=`(${currentPart+1} / ${totalParts} Parts)`;const savedDataJSON=localStorage.getItem(`${projectId}-part${currentTab+1}`);if(savedDataJSON){const savedData=JSON.parse(savedDataJSON);updateTextareaWithTransformedData(savedData,currentTab)}$(`#chatGPT_progress-label${currentTab}`).text(ratioText),$(".modal-footer.chatGPT-widget-footer .atlt_actions").removeClass("chatGPT_disable"),$(".chatGPT_save_cont").removeClass("btn-disabled"),$(".chatGPT_save_close").removeClass("btn-disabled"),$(".chatGPT_step-1, .chatGPT_step-2, .chatGPT_step-3").removeClass("chatGPT_steps-border")}})),$(".chatGPT_save_cont:first").on("click",(function(){$(".modal-footer.chatGPT-widget-footer .atlt_actions").addClass("chatGPT_disable"),$("#prevButton").show(),$(".chatGPT_save_cont").addClass("btn-disabled"),$(".chatGPT_save_close").addClass("btn-disabled"),$("#prevButton, .notice, .inline, .notice-info, .is-dismissible").show();const savedDataJSON=localStorage.getItem(`${projectId}-part${currentTab+1}`),savedDataJSON2=localStorage.getItem(`${projectId}-part${currentTab+2}`);if((savedDataJSON||savedDataJSON2)&&currentTab<parts.length-1){var errorContainer=$(`#chatGptError${currentTab}`);if(currentTab++,updateChatGptButtons(parts,currentTab,modelContainer,projectId),showTab(currentTab),errorContainer&&($(".chatGptError, .clear-button, .preview-button").hide(),$("textarea").val("")),currentPart>=totalParts)return;currentPart++,progressbar.css("width",Math.round(100*currentPart/totalParts)+"%");var ratioText=`(${currentPart+1} / ${totalParts} Parts)`;if($(`#chatGPT_progress-label${currentTab}`).text(ratioText),localStorage.getItem(`${projectId}-part${currentTab+1}`)){$(".modal-footer.chatGPT-widget-footer .atlt_actions").removeClass("chatGPT_disable"),$(".chatGPT_save_cont").removeClass("btn-disabled"),$(".chatGPT_save_close").removeClass("btn-disabled"),$(".chatGPT_step-1, .chatGPT_step-2, .chatGPT_step-3").removeClass("chatGPT_steps-border");const saveData=JSON.parse(savedDataJSON2);updateTextareaWithTransformedData(saveData,currentTab)}else $(".chatGPT_step-2, .chatGPT_step-3").removeClass("chatGPT_steps-border"),$(".chatGPT_step-1").addClass("chatGPT_steps-border")}})),$(".chatGPT_save_close").on("click",(function(){const savedDataJSON=localStorage.getItem(`${projectId}-part${currentTab+1}`);if(savedDataJSON){const mergedData=mergeLocalStorageData(parts,translatedObj),totalChars=mergedData.reduce((sum,item)=>sum+item.source.length,0),totalWords=mergedData.reduce((sum,item)=>sum+item.source.split(/\s+/).length,0),translationProvider="ChatGPT",timeTaken=0,translationData={time_taken:timeTaken,translation_provider:translationProvider,character_count:totalChars,string_count:totalWords,pluginORthemeName:pluginOrThemeName};saveTranslatedStrings(mergedData,projectId,translationData),$("#chatGPT-widget-model").fadeOut("slow",(function(){for(let j=0;j<parts.length;j++)localStorage.removeItem(`${projectId}-part${j+1}`),$(".container").length>0&&$(".container").remove()})),$("html").addClass("merge-translations"),updateLocoModel()}})),createTableFromLocalStorage(parts,projectId),actionsPerPart(parts,locale,projectId,translatedObj,modelContainer)}function createParts(parts,source_String,max_size,modelContainer){parts.length=0;const tabContainer=document.getElementById("tabContainer"),sourceKeys=Object.keys(source_String),maxTokensPerPart=500;let part={},currentPartTokens=0,currentPartStrings=0;for(const key of sourceKeys){const keyTokens=countTokens(source_String[key]);if(currentPartTokens+keyTokens>500){parts.push(part);const tabContent=createPartsContent(parts.length-1,modelContainer);tabContainer.appendChild(tabContent),part={},currentPartTokens=0,currentPartStrings=0}if(currentPartStrings>=max_size){parts.push(part);const tabContent=createPartsContent(parts.length-1,modelContainer);tabContainer.appendChild(tabContent),part={},currentPartTokens=0,currentPartStrings=0}if(part[key]=source_String[key],currentPartTokens+=keyTokens,currentPartStrings++,currentPartTokens>=500){parts.push(part);const tabContent=createPartsContent(parts.length-1,modelContainer);tabContainer.appendChild(tabContent),part={},currentPartTokens=0,currentPartStrings=0}$(".chatGptError").hide()}if(Object.keys(part).length>0){parts.push(part);const tabContent=createPartsContent(parts.length-1,modelContainer);tabContainer.appendChild(tabContent)}return tabContainer}function countTokens(inputString){return inputString.split(" ").length}function createPartsContent(partIndex,modelContainer){const containerDiv=document.createElement("div");return containerDiv.className="container",containerDiv.innerHTML=`\n        <input type="hidden" data-nextIndexVal="${partIndex}" id= "input${partIndex}">\n        <h1 style ="text-align: center;" id="Part${partIndex}">Part ${partIndex+1} <span style= "font-size: large;" id="chatGPT_progress-label${partIndex}"></span></h1>\n        <div class="formBody">\n        <input type="hidden" id="translate${partIndex}">\n    \n        <table class="chatGPT_steps" id="chatGPT_steps${partIndex}">\n            <tr>\n            <td class= "chatGPT_step-1">\n              <h2>Step 1</h2>\n              <p>Click on the copy button to copy the strings</p>\n              <button class="button button-primary copy-button" id="copyButton${partIndex}" type="button" name="copy">Copy</button>\n            </td>\n            <td class= "chatGPT_step-2">\n              <h2>Step 2</h2>\n              <p>Visit <a class = "chatGPT_step-2-anchor" href="https://chat.openai.com/" target="_blank">https://chat.openai.com/</a><br/>and paste strings in ChatGPT<br/>for translation.</p>\n            </td>\n            </tr>\n            <tr>\n            <td colspan="2" class= "chatGPT_step-3">\n              <h2>Step 3</h2>\n              <p>Now copy the translated string that ChatGPT gives you and paste it into the below section <span style="font-size: smaller;">(must be in JSON Format) <button type="button" class="preview-button button button-primary" id="preview${partIndex}">Preview</button></span></p>\n              <div style="position: relative;">\n                        <textarea id="output${partIndex}" class="output-box" rows="5" cols="130" style="width: 100%;" placeholder="Add translated strings here..."></textarea>\n                        <button type="button" class="clear-button button button-primary" id="clearButton${partIndex}">Clear</button>\n                </div>\n            </td>\n            </tr>\n            </table>\n            </div>\n            <button type= "button" class="button button-primary chatGPT_table_close" id = "chatGPT_table_close${partIndex}" style="float:right; font-size:14px; margin: 10px 0;">Close</button>\n            <div id="table${partIndex}" class = "chatGPT_table"></div>`,containerDiv}function showTab(tabIndex){$(".container").hide(),$(`.container:eq(${tabIndex})`).show()}function errorHandling(errorMsg,currentTab){$(".chatGptError").attr("id",`chatGptError${currentTab}`),$(`#chatGptError${currentTab}`).html(errorMsg)}function updateChatGptButtons(parts,currentTab,modelContainer,projectId){parts.length<=1?($("#prevButton").prop("disabled",!0),$(".chatGPT_save_cont").prop("disabled",!0)):0===currentTab?($("#prevButton").prop("disabled",!0),$(".chatGPT_save_cont").prop("disabled",!1)):currentTab===parts.length-1?($("#prevButton").prop("disabled",!1),$(".chatGPT_save_cont").prop("disabled",!0)):($("#prevButton").prop("disabled",!1),$(".chatGPT_save_cont").prop("disabled",!1))}function updateTextareaWithTransformedData(savedData,tabIndex){const textarea=document.getElementById(`output${tabIndex}`);if(textarea){const transformedData=Object.entries(savedData).map(([key,value])=>({id:parseInt(key),target:value.target}));transformedData.sort((a,b)=>a.id-b.id),textarea.value=JSON.stringify(transformedData,null,2)}$(`#clearButton${tabIndex}`).show(),$(`#preview${tabIndex}`).show()}function createTableFromLocalStorage(parts,projectId){parts.forEach((part,i)=>{const savedDataJSON=localStorage.getItem(`${projectId}-part${i+1}`);if(savedDataJSON){const savedData=JSON.parse(savedDataJSON);let savedDataHTML='<table class="table">';savedDataHTML+='<tr><th scope="col">S. No.</th><th scope="col">Source</th><th scope="col">Target</th></tr>',Object.keys(savedData).forEach((key,index)=>{const source=savedData[key].source,target=savedData[key].target,escapeSource=source?escapeHtml(source):"",escapetarget=target?escapeHtml(target):"";savedDataHTML+=`<tr><td>${key}</td><td class = "source">${escapeSource}</td><td class = "target">${escapetarget}</td></tr>`}),savedDataHTML+="</table>";const tableDiv=document.querySelector(`#table${i}`);tableDiv.innerHTML=savedDataHTML,$(".chatGPT_step-1").removeClass("chatGPT_steps-border"),updateTextareaWithTransformedData(savedData,i),$(".modal-footer.chatGPT-widget-footer .atlt_actions").removeClass("chatGPT_disable"),$(".chatGPT_save_cont").removeClass("btn-disabled"),$(".chatGPT_save_close").removeClass("btn-disabled")}else{const tableDiv=document.querySelector(`#table${i}`);let tableHTML='<table class="table">';tableHTML+='<tr><th scope="col">S. No.</th><th scope="col">Source</th><th scope="col">Target</th></tr>',Object.keys(part).forEach((key,index)=>{const value=part[key],escapeValue=value?encodeHtmlEntity(value):"";tableHTML+=`<tr><td>${key}</td><td class = "source">${escapeValue}</td><td class = "target"></td></tr>`}),tableHTML+="</table>",tableDiv.innerHTML=tableHTML}})}function escapeHtml(html){return html.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function createPartsTable(i,textareaValue,projectId,jsonArray){const dataToSave={};function isValidJSONString(str){try{return JSON.parse(str),!0}catch(error){if(textareaValue.startsWith("You are a helpful assistant that translates and replies with well-formed JSON")){var errorMsg="Untranslated Strings! *You have pasted the untranslated strings, Please translate them first";return $(".chatGptError").show(),errorHandling(errorMsg,i),!1}var errorMsg='Invalid JSON Format! *Please enter a valid JSON-formatted string in the textarea. Click <a href="https://locoaddon.com/docs/pro-plugin/ai-translation-issues-and-solutions/" target="_blank">here</a> to validate your JSON';$(".chatGptError").show(),errorHandling(errorMsg,i)}}if(isValidJSONString(textareaValue)){const parsedJSON=JSON.parse(textareaValue);if(Array.isArray(parsedJSON)){const tableDiv=document.querySelector(`#table${i}`);if(parsedJSON&&parsedJSON[0]&&parsedJSON[0][1]&&parsedJSON[0][1].source){if(firstSourceInTable!==parsedJSON[0][1].source){var errorMsg="Wrong translated strings! *Please enter right strings translation";return $(".chatGptError").show(),errorHandling(errorMsg,i),!1}{tableDiv.innerHTML="";let resultHtml='<table class="table">';resultHtml+='<tr><th scope="col">S. No.</th><th scope="col">Source</th><th scope="col">Target</th></tr>',parsedJSON.forEach((obj,index)=>{if("object"==typeof obj&&null!==obj){const key=Object.keys(obj)[0],{source:source,target:target}=obj[key],escapeSource=source?escapeHtml(source):"",escapetarget=target?escapeHtml(target):"";resultHtml+=`<tbody><tr><td>${key}</td><td class="source">${escapeSource}</td><td class="target">${escapetarget}</td></tr></tbody>`,dataToSave[key]={source:source,target:target};var errorMsg="";$(".chatGptError").hide(),errorHandling("",i),$(".modal-footer.chatGPT-widget-footer .atlt_actions").removeClass("chatGPT_disable"),$(".chatGPT_save_cont").removeClass("btn-disabled"),$(".chatGPT_save_close").removeClass("btn-disabled")}}),resultHtml+="</table>",tableDiv.innerHTML+=resultHtml;const dataToSaveJSON=JSON.stringify(dataToSave);localStorage.setItem(`${projectId}-part${i+1}`,dataToSaveJSON),$(".chatGPT_step-1, .chatGPT_step-2, .chatGPT_step-3").removeClass("chatGPT_steps-border");var errorMsg="";$(".chatGptError").hide(),errorHandling(errorMsg,i),$(".modal-footer.chatGPT-widget-footer .atlt_actions").removeClass("chatGPT_disable"),$(".chatGPT_save_cont").removeClass("btn-disabled"),$(".chatGPT_save_close").removeClass("btn-disabled")}}else if(Array.isArray(parsedJSON)&&parsedJSON.length>0&&parsedJSON.every(item=>item.hasOwnProperty("target"))){const matchingTranslations=[];if(parsedJSON.forEach(item=>{if(item.id){const sourceMatch=jsonArray.find(source=>source.id===item.id);sourceMatch&&matchingTranslations.push({key:item.id,source:sourceMatch.source,target:item.target})}}),!(matchingTranslations.length>0)){var errorMsg="Wrong translated strings! *Please enter right strings translation";return $(".chatGptError").show(),errorHandling(errorMsg,i),!1}{tableDiv.innerHTML="";let resultHtml='<table class="table">';resultHtml+='<tr><th scope="col">S. No.</th><th scope="col">Source</th><th scope="col">Target</th></tr>',matchingTranslations.forEach(translation=>{const escapeSource=translation.source?escapeHtml(translation.source):"",escapetarget=translation.target?escapeHtml(translation.target):"";resultHtml+=`<tbody><tr><td>${translation.key}</td><td class="source">${escapeSource}</td><td class="target">${escapetarget}</td></tr></tbody>`,dataToSave[translation.key]={source:translation.source,target:translation.target};var errorMsg="";$(".chatGptError").hide(),errorHandling("",i),$(".modal-footer.chatGPT-widget-footer .atlt_actions").removeClass("chatGPT_disable"),$(".chatGPT_save_cont").removeClass("btn-disabled"),$(".chatGPT_save_close").removeClass("btn-disabled")}),resultHtml+="</table>",tableDiv.innerHTML+=resultHtml;const dataToSaveJSON=JSON.stringify(dataToSave);localStorage.setItem(`${projectId}-part${i+1}`,dataToSaveJSON),$(".chatGPT_step-1, .chatGPT_step-2, .chatGPT_step-3").removeClass("chatGPT_steps-border");var errorMsg="";$(".chatGptError").hide(),errorHandling(errorMsg,i),$(".modal-footer.chatGPT-widget-footer .atlt_actions").removeClass("chatGPT_disable"),$(".chatGPT_save_cont").removeClass("btn-disabled"),$(".chatGPT_save_close").removeClass("btn-disabled")}}}else{if("object"!=typeof parsedJSON||Array.isArray(parsedJSON)){var errorMsg="Invalid JSON Format! *Please enter a valid JSON-formatted String in the textarea.";return $(".chatGptError").show(),errorHandling(errorMsg,i),!1}{const keys=Object.keys(parsedJSON),tableDiv=document.querySelector(`#table${i}`),tableSourceCells=tableDiv.querySelectorAll(".source"),firstSourceInTable=tableSourceCells[0].textContent;if(firstSourceInTable!==parsedJSON[keys[0]].source){var errorMsg="Wrong translated strings! *Please enter right strings translation";return $(".chatGptError").show(),errorHandling(errorMsg,i),!1}{let resultHtml='<table class="table">';resultHtml+='<tr><th scope="col">S. No.</th><th scope="col">Source</th><th scope="col">Target</th></tr>',keys.forEach(key=>{const{source:source,target:target}=parsedJSON[key],escapeSource=source?escapeHtml(source):"",escapetarget=target?escapeHtml(target):"";resultHtml+=`<tbody><tr><td>${key}</td><td class="source">${escapeSource}</td><td class="target">${escapetarget}</td></tr></tbody>`,dataToSave[key]={source:source,target:target}}),resultHtml+="</table>",tableDiv.innerHTML=resultHtml;const dataToSaveJSON=JSON.stringify(dataToSave);localStorage.setItem(`${projectId}-part${i+1}`,dataToSaveJSON),$(".chatGPT_step-1, .chatGPT_step-2, .chatGPT_step-3").removeClass("chatGPT_steps-border");var errorMsg="";$(".chatGptError").hide(),errorHandling(errorMsg,i),$(".modal-footer.chatGPT-widget-footer .atlt_actions").removeClass("chatGPT_disable"),$(".chatGPT_save_cont").removeClass("btn-disabled"),$(".chatGPT_save_close").removeClass("btn-disabled")}}}}}function actionsPerPart(parts,locale,projectId,translatedObj,modelContainer){parts.forEach((part,i)=>{const jsonArray=Object.entries(part).map(([key,value])=>({id:Number(key),source:value.trim()})),jsonString=JSON.stringify(jsonArray,null,2),prompt=`\n                You are translating a JSON array into **${locale.label}**. Follow these instructions carefully to maintain accuracy and formatting:\n\n                ### **Translation Rules:**\n                1. **Preserve Placeholders** – Do **not** translate placeholders like \`%s\`, \`%d\`, \`%S\`, \`%D\`.\n                2. **Keep Original IDs** – Retain the \`id\` key as is. If a string is skipped, its \`id\` must still be included.\n                3. **Strict JSON Format** – Output must be a **valid JSON array** with **only** \`id\` and \`target\` keys.\n                4. **Exclude 'source' Key** – The \`source\` field must not appear in the output.\n                5. **Escape Special Characters** – Ensure valid JSON by properly escaping quotes (\`"\` and \`'\`).\n                6. **Accurate Translation** – Each string must be correctly translated into **${locale.label}**, even if some translations remain the same.\n                7. **Complete Output** – Translate **all ${jsonArray.length} items**, ensuring the exact same count in the final array.\n\n                ---\n\n                ### **Input JSON:**\n                \`\`\`json\n                ${jsonString}\n                \`\`\`\n\n                ### **Expected Output Format:**\n                \`\`\`json\n                [\n                { "id": 1, "target": "(translated text in ${locale.label})" },\n                { "id": 2, "target": "(translated text in ${locale.label})" },\n                ...\n                ]\n                \`\`\`\n\n                ### **Final Notes:**\n                - **Ensure valid and complete JSON output** without missing or extra entries.\n                - **Follow the specified format exactly.** No additional keys or modifications are allowed.\n                - **Do not include any explanations**—return only the JSON array.\n\n                `;document.getElementById(`translate${i}`).value=prompt;const copyButton=document.getElementById(`copyButton${i}`);copyButton.addEventListener("click",(function(){$(".chatGPT_step-1, .chatGPT_step-3, .chatGPT_save_cont").removeClass("chatGPT_steps-border"),$(".chatGPT_step-2").addClass("chatGPT_steps-border");const inputField=document.getElementById(`translate${i}`),textArea=document.createElement("textarea");textArea.value=inputField.value,document.body.appendChild(textArea),textArea.select(),document.execCommand("copy"),document.body.removeChild(textArea),copyButton.innerText="Copied",setTimeout(()=>{window.open("https://chat.openai.com","_blank")},800),setTimeout((function(){$(".chatGPT_step-2").removeClass("chatGPT_steps-border"),$(".chatGPT_step-3").addClass("chatGPT_steps-border")}),1e3),setTimeout(()=>{copyButton.innerText="Copy"},6e3)}));const textarea=document.getElementById(`output${i}`);textarea.addEventListener("input",(function(event){setTimeout((function(){const textareaValue=textarea.value;if(""!==textareaValue&&(createPartsTable(i,textareaValue,projectId,jsonArray),$(`#clearButton${i}`).show(),$(`#preview${i}`).show()),""==textareaValue){var errorMsg="";$(".chatGptError").hide(),$(`#clearButton${i}`).hide(),$(`#preview${i}`).hide(),$(".modal-footer.chatGPT-widget-footer .atlt_actions").addClass("chatGPT_disable"),$(".chatGPT_save_cont").addClass("btn-disabled"),$(".chatGPT_save_close").addClass("btn-disabled"),errorHandling("",i)}}),100)}));const clearTextareaButton=document.getElementById(`clearButton${i}`);clearTextareaButton.addEventListener("click",(function(){$(`#output${i}`).val(""),$(`#clearButton${i}`).hide(),$(`#preview${i}`).hide();var errorMsg="";$(".chatGptError").hide(),errorHandling("",i)}));const previewButton=document.getElementById(`preview${i}`);previewButton.addEventListener("click",(function(){$(`#Part${i}`).hide(),$(`#chatGPT_steps${i}`).hide(),$("#prevButton, .notice, .inline, .notice-info, .is-dismissible").hide(),$(`#chatGPT_table_close${i}`).show(),$(`#table${i}`).show()}));const chatGPTTableClose=document.getElementById(`chatGPT_table_close${i}`);chatGPTTableClose.addEventListener("click",(function(){$(`#Part${i}`).show(),$(`#chatGPT_steps${i}`).show(),$("#prevButton, .notice, .inline, .notice-info, .is-dismissible").show(),$(`#chatGPT_table_close${i}`).hide(),$(`#table${i}`).hide()})),setInterval((function(){const savedDataJSON=localStorage.getItem(`${projectId}-part${parts.length}`);$(".chatGptError").is(":empty")&&savedDataJSON?modelContainer.find(".atlt_stats").fadeIn("slow"):modelContainer.find(".atlt_stats").hide()}),200)})}function mergeLocalStorageData(parts,translatedObj){const rpl={'"% s"':'"%s"','"% d"':'"%d"','"% S"':'"%s"','"% D"':'"%d"',"% s":" %s ","% S":" %s ","% d":" %d ","% D":" %d ","٪ s":" %s ","٪ S":" %s ","٪ d":" %d ","٪ D":" %d ","٪ س":" %s ","%S":" %s ","%D":" %d ","% %":"%%"},regex=/(\%\s*\d+\s*\$?\s*[a-z0-9])/gi;return parts.forEach((part,i)=>{$(`#table${i} tbody tr`).slice(1).each((function(index){var index=$(this).find("td.source").text(),target=$(this).find("td.target").text(),source=$(this).find("td.source").text();let improvedTarget,improvedSource;if(""!=target&&""!=source){const improvedTargetrpl=strtr(target,rpl),improvedSourcerpl=strtr(source,rpl);improvedTarget=improvedTargetrpl.replace(regex,(function(match){return match.replace(/\s/g,"").toLowerCase()})),improvedSource=improvedSourcerpl.replace(regex,(function(match){return match.replace(/\s/g,"").toLowerCase()}))}null!=improvedTarget&&null!=improvedSource&&translatedObj.push({source:improvedSource,target:improvedTarget})}))}),translatedObj}function onSaveClick(){let translatedObj=[],type=this.getAttribute("data-type"),total_character_count=0,total_word_count=0;const rpl={'"% s"':'"%s"','"% d"':'"%d"','"% S"':'"%s"','"% D"':'"%d"',"% s":" %s ","% S":" %s ","% d":" %d ","% D":" %d ","٪ s":" %s ","٪ S":" %s ","٪ d":" %d ","٪ D":" %d ","٪ س":" %s ","%S":" %s ","%D":" %d ","% %":"%%"},regex=/(\%\s*\d+\s*\$?\s*[a-z0-9])/gi;$("."+type+"-widget-body").find(".atlt_strings_table tbody tr").each((function(){const source=$(this).find("td.source").text(),target=$(this).find("td.target").text(),improvedTargetrpl=strtr(target,rpl),improvedSourcerpl=strtr(source,rpl),improvedTarget=improvedTargetrpl.replace(regex,(function(match){return match.replace(/\s/g,"").toLowerCase()})),improvedSource=improvedSourcerpl.replace(regex,(function(match){return match.replace(/\s/g,"").toLowerCase()}));total_character_count+=improvedSource.length,total_word_count+=improvedSource.split(/\s+/).length,translatedObj.push({source:improvedSource,target:improvedTarget})}));const container=$(this).closest(".atlt_custom_model"),translationProvider=container.data("translation-provider"),translationTime=container.data("translation-time"),{lang:lang,region:region}=locoConf.conf.locale,target_language=region?`${lang}_${region}`:lang,totalCharacters=translatedObj.reduce((sum,item)=>sum+item.source.length,0),totalStrings=translatedObj.length,translationData={time_taken:translationTime,translation_provider:translationProvider,character_count:totalCharacters,string_count:totalStrings,pluginORthemeName:pluginOrThemeName,target_language:target_language};var projectId=$(this).parents(".atlt_custom_model").find("#project_id").val();saveTranslatedStrings(translatedObj,projectId,translationData),$(".atlt_custom_model").fadeOut("slow"),$("html").addClass("merge-translations"),updateLocoModel()}function updateLocoModel(){var checkModal=setInterval((function(){var locoModel=$(".loco-modal"),locoModelApisBatch=$(".loco-modal #loco-apis-batch");if(locoModel.length&&locoModel.attr("style").indexOf("none")<=-1&&locoModel.find("#loco-job-progress").length){$("html").removeClass("merge-translations"),locoModelApisBatch.find("a.icon-help, a.icon-group, #loco-job-progress").hide(),locoModelApisBatch.find("select#auto-api").hide();var currentState=$("select#auto-api option[value='loco_auto']").prop("selected","selected");locoModelApisBatch.find("select#auto-api").val(currentState.val()),locoModel.find(".ui-dialog-titlebar .ui-dialog-title").html("Step 3 - Add Translations into Editor and Save"),locoModelApisBatch.find("button.button-primary span").html("Start Adding Process"),locoModelApisBatch.find("button.button-primary").on("click",(function(){$(this).find("span").html("Adding...")})),locoModel.addClass("addtranslations"),$(".noapiadded").remove(),locoModelApisBatch.find("form").show(),locoModelApisBatch.removeClass("loco-alert"),clearInterval(checkModal)}}),200)}function openTranslationProviderModel(e){if(void 0!==e.originalEvent)var checkModal=setInterval((function(){var locoModal=$(".loco-modal"),locoBatch=locoModal.find("#loco-apis-batch"),locoTitle=locoModal.find(".ui-dialog-titlebar .ui-dialog-title"),opt;locoBatch.length&&!locoModal.is(":hidden")&&(locoModal.removeClass("addtranslations"),locoBatch.find("select#auto-api").show(),locoBatch.find("a.icon-help, a.icon-group").show(),locoBatch.find("#loco-job-progress").show(),locoTitle.html("Auto-translate this file"),locoBatch.find("button.button-primary span").html("Translate"),1===locoBatch.find("select#auto-api option").length&&(locoBatch.find(".noapiadded").remove(),locoBatch.removeClass("loco-alert"),locoBatch.find("form").hide(),locoBatch.addClass("loco-alert"),locoTitle.html("No translation APIs configured"),locoBatch.append("<div class='noapiadded'>\n                            <p>Add automatic translation services in the plugin settings.<br>or<br>Use <strong>Auto Translate</strong> addon button.</p>\n                            <nav>\n                                <a href='http://locotranslate.local/wp-admin/admin.php?page=loco-config&amp;action=apis' class='button button-link has-icon icon-cog'>Settings</a>\n                                <a href='https://localise.biz/wordpress/plugin/manual/providers' class='button button-link has-icon icon-help' target='_blank'>Help</a>\n                                <a href='https://localise.biz/wordpress/translation?l=de-DE' class='button button-link has-icon icon-group' target='_blank'>Need a human?</a>\n                            </nav>\n                        </div>")),clearInterval(checkModal))}),100)}function filterRawObject(rawArray,filterType){return rawArray.filter(item=>!(!item.source||item.target)&&(!(ValidURL(item.source)||isHTML(item.source)||isSpecialChars(item.source)||isEmoji(item.source)||item.source.includes("#"))&&(isPlacehodersChars(item.source),!0)))}function ValidURL(str){var pattern;return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(str)}function isHTML(str){var rgex;return/<(?=.*? .*?\/ ?>|br|hr|input|!--|wbr)[a-z]+.*?>|<([a-z]+).*?<\/\1>/i.test(str)}function isSpecialChars(str){var rgex;return/[@^{}|<>]/g.test(str)}function isEmoji(str){var ranges=["(?:[✀-➿]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[#-9]️?⃣|㊙|㊗|〽|〰|Ⓜ|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|🆎|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|[\ud83c[\ude01-\ude02]|🈚|🈯|[\ud83c[\ude32-\ude3a]|[\ud83c[\ude50-\ude51]|‼|⁉|[▪-▫]|▶|◀|[◻-◾]|©|®|™|ℹ|🀄|[☀-⛿]|⬅|⬆|⬇|⬛|⬜|⭐|⭕|⌚|⌛|⌨|⏏|[⏩-⏳]|[⏸-⏺]|🃏|⤴|⤵|[←-⇿])"];return str.match(ranges.join("|"))}function isPlacehodersChars(str){var rgex;return/%s|%d/g.test(str)}function strtr(s,p,r){return!!s&&{2:function(){for(var i in p)s=strtr(s,i,p[i]);return s},3:function(){return s.replace(RegExp(p,"g"),r)},0:function(){}}[arguments.length]()}function saveTranslatedStrings(translatedStrings,projectId,translationData){if(translatedStrings&&translatedStrings.length>0){const batchSize=2500;for(let i=0;i<translatedStrings.length;i+=batchSize){const batch=translatedStrings.slice(i,i+batchSize),part=`-part-${Math.ceil(i/batchSize)}`;sendBatchRequest(batch,projectId,part,translationData)}}}function sendBatchRequest(stringData,projectId,part,translationData){const data={action:"save_all_translations",data:JSON.stringify(stringData),part:part,"project-id":projectId,wpnonce:nonce,translation_data:JSON.stringify(translationData)};$.ajax({url:ajaxUrl,method:"POST",data:data,dataType:"json",success:function(response){$('#loco-editor nav button[data-loco="auto"]').trigger("click")},error:function(xhr,status,error){console.error(error)}})}function addAutoTranslationBtn(){const existingBtn=$("#loco-editor nav").find("#cool-auto-translate-btn");existingBtn.length>0&&existingBtn.remove();const locoActions=$("#loco-editor nav").find("#loco-actions"),autoTranslateBtn=$('<fieldset><button id="cool-auto-translate-btn" class="button has-icon icon-translate">Auto Translate</button></fieldset>');locoActions.append(autoTranslateBtn)}function openSettingsModel(){$("#atlt-dialog").dialog({dialogClass:rtlClass,resizable:!1,height:"auto",width:400,modal:!0,draggable:!1,buttons:{Cancel:function(){$(this).dialog("close")}}})}onLoad();var modals=document.querySelectorAll(".atlt_custom_model");function encodeHtmlEntity(str){for(var buf=[],i=str.length-1;i>=0;i--)buf.unshift(["&#",str[i].charCodeAt(),";"].join(""));return buf.join("")}function printStringsInPopup(jsonObj,type){let html="",totalTChars=0,index=1,custom_attr="yandex"===type?'translate="yes"':"";if(jsonObj){for(const key in jsonObj)if(jsonObj.hasOwnProperty(key)){const element=jsonObj[key],sourceText=element.source.trim();if(""!==sourceText&&("yandex"==type||"google"==type||"deepl"==type||"geminiAI"==type||"openAI"==type||"ChromeAiTranslator"==type)){html+=`<tr id="${key}"><td>${index}</td><td class="notranslate source">${encodeHtmlEntity(sourceText)}</td>`,html+="yandex"==type||"google"==type||"ChromeAiTranslator"==type?`<td   ${custom_attr}  class="target translate">${sourceText}</td></tr>`:'<td class="target translate"></td></tr>';const div=document.createElement("div");div.innerHTML=sourceText,index++,totalTChars+=div.innerText.length}}$(".atlt_stats").each((function(){$(this).find(".totalChars").html(totalTChars)}))}$("#"+type+"-widget-model").find(".atlt_strings_table > tbody.atlt_strings_body").html(html)}function settingsModel(){const icons={yandex:extradata.yt_preview,google:extradata.gt_preview,deepl:extradata.dpl_preview,chatgpt:extradata.chatGPT_preview,gemini:extradata.geminiAI_preview,openai:extradata.openai_preview,chrome:extradata.chromeAi_preview,docs:extradata.document_preview,error:extradata.error_preview},url="https://locoaddon.com/docs/",ATLT_IMG=key=>ATLT_URL+"assets/images/"+icons[key],DOC_ICON_IMG=`<img src="${ATLT_IMG("docs")}" width="20" alt="Docs">`,hasGeminiKey=Array.isArray(apikey)&&apikey.includes("google"),hasOpenAIKey=Array.isArray(apikey)&&apikey.includes("openai"),hasDeepLKey=Array.isArray(apikey)&&apikey.includes("deepl"),rows=[{name:"Chrome Built-in AI",icon:"chrome",info:"https://developer.chrome.com/docs/ai/translator-api",doc:`${url}how-to-use-chrome-ai-auto-translations/?utm_source=atlt_plugin&utm_medium=inside&utm_campaign=docs&utm_content=popup_chrome_pro`,btn:`\n                    <button id="ChromeAiTranslator_settings_btn" class="atlt-provider-btn translate">Translate</button>\n                    <button id="atlt-chromeai-disabled-message" class="atlt-provider-btn error d-none">\n                        <img src="${ATLT_IMG("error")}" alt="error" style="height:16px; vertical-align:middle; margin-right:5px;">\n                        View Error\n                    </button>\n                    <div id="atlt-chromeai-disabled-message-content" style="display:none;"></div>\n                `}],rowHTML=rows.map(row=>`\n            <tr>\n                <td class="atlt-provider-name">\n                    <a href="${row.info}" target="_blank">\n                        <img src="${ATLT_IMG(row.icon)}" class="atlt-provider-icon" alt="${row.name}">\n                    </a>\n                    ${row.name}\n                </td>\n                <td>${row.btn}</td>\n                <td>\n                    <a href="${row.doc}" target="_blank" class="atlt-provider-docs-btn">${DOC_ICON_IMG}</a>\n                </td>\n            </tr>\n        `).join(""),modelHTML=`\n            <div class="atlt-provider-modal" id="atlt-dialog" title="Step 2 - Select Translation Provider" style="display:none;">\n                <table class="atlt-provider-table">\n                    <thead>\n                        <tr><th>Name</th><th>Translate</th><th>Docs</th></tr>\n                    </thead>\n                    <tbody>${rowHTML}</tbody>\n                </table>\n            </div>\n        `;$("body").append(modelHTML)}function createStringsModal(projectId,widgetType){let{wrapperCls:wrapperCls,headerCls:headerCls,bodyCls:bodyCls,footerCls:footerCls,modelId:modelId}=getWidgetClasses(widgetType),modelHTML=`\n            <div id="${modelId}" class="modal atlt_custom_model  ${wrapperCls} ${rtlClass}">\n                <div class="modal-content">\n                    <input type="hidden" id="project_id" value="${projectId}"> \n                    ${modelHeaderHTML(widgetType,headerCls)}   \n                    ${modelBodyHTML(widgetType,bodyCls)}   \n                    ${modelFooterHTML(widgetType,footerCls)} \n                    </div>\n                </div>`;$("body").append(modelHTML)}function getWidgetClasses(widgetType){let wrapperCls="",headerCls="",bodyCls="",footerCls="",modelId="";switch(widgetType){case"yandex":wrapperCls="yandex-widget-container",headerCls="yandex-widget-header",bodyCls="yandex-widget-body",footerCls="yandex-widget-footer",modelId="yandex-widget-model",type="yandex";break;case"google":wrapperCls="google-widget-container",headerCls="google-widget-header",bodyCls="google-widget-body",footerCls="google-widget-footer",modelId="google-widget-model",type="google";break;case"deepl":wrapperCls="deepl-widget-container",headerCls="deepl-widget-header",bodyCls="deepl-widget-body",footerCls="deepl-widget-footer",modelId="deepl-widget-model",type="deepl";break;case"ChromeAiTranslator":wrapperCls="ChromeAiTranslator-widget-container",headerCls="ChromeAiTranslator-widget-header",bodyCls="ChromeAiTranslator-widget-body",footerCls="ChromeAiTranslator-widget-footer",modelId="ChromeAiTranslator-widget-model",type="ChromeAiTranslator";break;case"chatGPT":wrapperCls="chatGPT-widget-container",headerCls="chatGPT-widget-header",bodyCls="chatGPT-widget-body",footerCls="chatGPT-widget-footer",modelId="chatGPT-widget-model",type="chatGPT";break;case"geminiAI":wrapperCls="geminiAI-widget-container",headerCls="geminiAI-widget-header",bodyCls="geminiAI-widget-body",footerCls="geminiAI-widget-footer",modelId="geminiAI-widget-model",type="geminiAI";break;case"openAI":wrapperCls="openAI-widget-container",headerCls="openAI-widget-header",bodyCls="openAI-widget-body",footerCls="openAI-widget-footer",modelId="openAI-widget-model",type="openAI";break;default:wrapperCls="yandex-widget-container",headerCls="yandex-widget-header",bodyCls="yandex-widget-body",footerCls="yandex-widget-footer"}return{wrapperCls:wrapperCls,headerCls:headerCls,bodyCls:bodyCls,footerCls:footerCls,modelId:modelId,type:type}}function modelBodyHTML(widgetType,bodyCls){const translator_type=`${type}`,capitalizedString=capitalizeFirstLetter(translator_type);function capitalizeFirstLetter(str){return(str=(str=str.replace("ChromeAiTranslator","Chrome AI")).replace("deepl","DeepL")).charAt(0).toUpperCase()+str.slice(1)}const HTML=`<div class = "modal-scrollbar">\n        <div class="notice inline notice-info is-dismissible">\n                        Plugin will not translate any strings with HTML or special characters because ${capitalizedString} Translator currently does not support HTML and special characters translations.\n                        You can edit translated strings inside Loco Translate Editor after merging the translations. Only special characters (%s, %d) fixed at the time of merging of the translations.\n                    </div>\n                    <div class="notice inline notice-info is-dismissible">\n                        Machine translations are not 100% correct.\n                        Please verify strings before using on the production website.\n                    </div>\n        <div class="modal-body  ${bodyCls}">\n            <div class="atlt_translate_progress">\n                Automatic translation is in progress....<br/>\n                It will take a few minutes, enjoy ☕ coffee in this time!<br/><br/>\n                Please do not leave this window or browser tab while the translation is in progress...\n\n            <div class="progress-wrapper">\n                <div class="progress-container">\n                    <div class="progress-bar" id="myProgressBar">\n                        <span id="progressText">0%</span>\n                    </div>\n                </div>\n            </div>\n            </div>\n            <div class="atlt_translate_warning-massage">\n                <div class="warning-massage-wrapper">\n                     <button class="close-button">&times;</button>\n                     <div class="warning-massage-content"></div>\n                </div>\n            </div>\n            ${translatorWidget(widgetType)}\n            <div class="atlt_string_container">\n                <table class="scrolldown atlt_strings_table">\n                    <thead>\n                        <th class="notranslate">S.No</th>\n                        <th class="notranslate">Source Text</th>\n                        <th class="notranslate">Translation</th>\n                    </thead>\n                    <tbody class="atlt_strings_body">\n                    </tbody>\n                </table>\n            </div>\n            <div class="notice-container"></div>\n        </div>\n        </div>`;return HTML}function modelHeaderHTML(widgetType,headerCls){if("yandex"===widgetType||"google"===widgetType||"deepl"===widgetType||"openAI"===widgetType||"geminiAI"===widgetType||"ChromeAiTranslator"===widgetType){const HTML=`\n        <div class="modal-header  ${headerCls}">\n                        <span class="close">&times;</span>\n                        <h2 class="notranslate">Step 2 - Start Automatic Translation Process</h2>\n                        <div class="atlt_actions">\n                            <button class="notranslate atlt_save_strings button button-primary" data-type = "${type}" disabled="true">Merge Translation</button>\n                        </div>\n                        <div style="display:none" class="atlt_stats hidden">\n                            Wahooo! You have saved your valuable time via auto translating \n                            <strong class="totalChars"></strong> characters  using \n                            <strong>\n                                <a href="https://wordpress.org/support/plugin/automatic-translator-addon-for-loco-translate/reviews/#new-post" target="_new">\n                                    LocoAI – Auto Translate for Loco Translate (Pro)\n                                </a>\n                            </strong>\n                        </div>\n                    </div>\n                    `;return HTML}if("chatGPT"===widgetType){const HTML=`\n        <div class="modal-header  ${headerCls}">\n                        <span class="close">&times;</span>\n                        <h2 class="notranslate">Step 2 - Start Automatic Translation Process</h2>\n                        <div class="atlt_actions">\n                            <button class="notranslate atlt_save_strings button button-primary" data-type = "${type}" disabled="true">Merge Translation</button>\n                        </div>\n                        <div style="display:none" class="atlt_stats hidden">\n                            Wahooo! You have saved your valuable time via auto translating \n                            <strong class="totalChars"></strong> characters  using \n                            <strong>\n                                <a href="https://wordpress.org/support/plugin/automatic-translator-addon-for-loco-translate/reviews/#new-post" target="_new">\n                                    LocoAI – Auto Translate for Loco Translate (Pro)\n                                </a>\n                            </strong>\n                        </div>\n                    </div>\n                    `;return HTML}}function modelFooterHTML(widgetType,footerCls){if("yandex"===widgetType||"google"===widgetType||"deepl"===widgetType||"geminiAI"===widgetType||"openAI"===widgetType||"ChromeAiTranslator"===widgetType){const HTML=` <div class="modal-footer ${footerCls}">\n        <div class="atlt_actions">\n            <button class="notranslate atlt_save_strings button button-primary" data-type = "${type}" disabled="true">Merge Translation</button>\n        </div>\n        <div style="display:none" class="atlt_stats">\n            Wahooo! You have saved your valuable time via auto translating \n            <strong class="totalChars"></strong> characters  using \n            <strong>\n                <a href="https://wordpress.org/support/plugin/automatic-translator-addon-for-loco-translate/reviews/#new-post" target="_new">\n                    LocoAI – Auto Translate for Loco Translate (Pro)\n                </a>\n            </strong>\n        </div>\n    </div>`;return HTML}if("chatGPT"===widgetType){const HTML=` <div class="modal-footer ${footerCls}">\n            <div class="atlt_actions chatGPT_disable">\n            <button data-type = "${type}" class="chatGPT_save_cont button button-primary btn-disabled">Save & Continue</button>\n            <button data-type = "${type}" class="chatGPT_save_close button button-primary btn-disabled">Save & Close</button>\n        </div>\n        <div class="chatGptError"></div>\n        <div style="display:none" class="atlt_stats">\n            Wahooo! You have saved your valuable time via auto translating \n            <strong class="totalChars"></strong> characters  using \n            <strong>\n                <a href="https://wordpress.org/support/plugin/automatic-translator-addon-for-loco-translate/reviews/#new-post" target="_new">\n                    LocoAI – Auto Translate for Loco Translate (Pro)\n                </a>\n            </strong>\n        </div>\n        </div>`;return HTML}return""}function translatorWidget(widgetType){if("yandex"===widgetType){const widgetPlaceholder='<div id="ytWidget">..Loading</div><br>';return`<div class="translator-widget  ${widgetType}">\n                    <h3 class="choose-lang">Choose language <span class="dashicons-before dashicons-translation"></span></h3>\n                    ${widgetPlaceholder}\n                </div>`}if("google"===widgetType){const widgetPlaceholder='<div id="google_translate_element"></div>';return`<div class="translator-widget  ${widgetType}">\n                    <h3 class="choose-lang">Choose language <span class="dashicons-before dashicons-translation"></span></h3>\n                    ${widgetPlaceholder}\n                </div>`}if("ChromeAiTranslator"===widgetType)return`<div class="translator-widget  ${widgetType}">\n                    <h3 class="choose-lang">Translate Using Chrome Built-in AI<div class="atlt_chrome_ai"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="none" stroke="#5cb85c" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m10 7l-.516 1.394c-.676 1.828-1.014 2.742-1.681 3.409s-1.581 1.005-3.409 1.681L3 14l1.394.516c1.828.676 2.742 1.015 3.409 1.681s1.005 1.581 1.681 3.409L10 21l.516-1.394c.676-1.828 1.015-2.742 1.681-3.409s1.581-1.005 3.409-1.681L17 14l-1.394-.516c-1.828-.676-2.742-1.014-3.409-1.681s-1.005-1.581-1.681-3.409zm8-4l-.221.597c-.29.784-.435 1.176-.72 1.461c-.286.286-.678.431-1.462.72L15 6l.598.221c.783.29 1.175.435 1.46.72c.286.286.431.678.72 1.462L18 9l.221-.597c.29-.784.435-1.176.72-1.461c.286-.286.678-.431 1.462-.72L21 6l-.598-.221c-.783-.29-1.175-.435-1.46-.72c-.286-.286-.431-.678-.72-1.462z" color="#5cb85c"/></svg></div></h3>\n                     <div id="chrome_ai_translator_element"></div>\n                </div>`;if("openAI"===widgetType){const widgetPlaceholder='\n                <div id="openAI_translate_element">\n                    <button id="openAI_translate_button" class="button button-primary">Translate with OpenAI</button>\n                </div>';return`<div class="translator-widget  ${widgetType}">\n                    <h3 class="choose-lang">Translate Using OpenAI <span class="dashicons-before dashicons-translation"></span></h3>\n                    ${widgetPlaceholder}\n                </div>`}if("geminiAI"===widgetType){const widgetPlaceholder='\n                <div id="geminiAI_translate_element">\n                    <button id="geminiAI_translate_button" class="button button-primary">Translate with GeminiAI</button>\n                </div>';return`<div class="translator-widget  ${widgetType}">\n                    <h3 class="choose-lang">Translate Using GeminiAI <span class="dashicons-before dashicons-translation"></span></h3>\n                    ${widgetPlaceholder}\n                </div>`}if("deepl"===widgetType){const widgetPlaceholder='\n            <div id="deepl_translate_element">\n                <button id="deepl_translate_button" class="button button-primary">Translate with DeepL</button>\n            </div>';return`<div class="translator-widget  ${widgetType}">\n                <h3 class="choose-lang">Translate Using DeepL <span class="dashicons-before dashicons-translation"></span></h3>\n            ${widgetPlaceholder}\n            </div>`}if("chatGPT"===widgetType){currentTab=0;const widgetPlaceholder='<div id="chatGPT_translate_element"></div>';return`<div class="translator-widget  ${widgetType}">\n            <div class="chatGPT_progress">\n          <div id="chatGPT_progressbar" style="width: 0%"></div>\n        </div>\n            <form id="Form">\n            <div id="tabContainer">\n            <button style="float:right; font-size:14px;" class="button button-primary prev_btn" id="prevButton" disabled="true" type="button">&#8249; Previous</button>\n            </div>\n            </form>\n                ${widgetPlaceholder}\n            </div>`}return""}$(window).click((function(event){event.target.closest(".modal-content")||destoryGoogleYandexTranslator();for(var i=0;i<modals.length;i++){var modal=modals[i];$(event.target).hasClass("atlt_custom_model")&&event.target===modal&&(modal.style.display="none",$(".container").length>0&&($(".chatGPT_steps-border").length>0&&$(".chatGPT_steps-border").removeClass("chatGPT_steps-border"),$(".container").remove()))}})),$(".atlt_custom_model").find(".close").on("click",(function(){destoryGoogleYandexTranslator(),$(".container").length>0&&($(".chatGPT_steps-border").length>0&&$(".chatGPT_steps-border").removeClass("chatGPT_steps-border"),$(".container").remove()),$(".atlt_custom_model").fadeOut("slow")})),$(document).ready((function(){initialize()}))}(window,jQuery,gTranslateWidget);